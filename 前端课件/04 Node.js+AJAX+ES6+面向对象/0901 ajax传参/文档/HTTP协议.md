# HTTP协议简介

超文本传输协议（英文：**H**yper**T**ext **T**ransfer **P**rotocol，缩写：HTTP）是一种用于分布式、协作式和超媒体信息系统的应用层协议。HTTP是万维网的数据通信的基础。

HTTP的发展是由蒂姆·伯纳斯-李于1989年在欧洲核子研究组织（CERN）所发起。HTTP的标准制定由万维网协会（World Wide Web Consortium，W3C）和互联网工程任务组（Internet Engineering Task Force，IETF）进行协调，最终发布了一系列的RFC，其中最著名的是1999年6月公布的 RFC 2616，定义了HTTP协议中现今广泛使用的一个版本——HTTP 1.1。

2014年12月，互联网工程任务组（IETF）的Hypertext Transfer Protocol Bis（httpbis）工作小组将HTTP/2标准提议递交至IESG进行讨论，于2015年2月17日被批准。 HTTP/2标准于2015年5月以RFC 7540正式发表，取代HTTP 1.1成为HTTP的实现标准。

# HTTP协议

## 特点

1. HTTP协议是一个不对等协议，通信的双方不是在同一个层次上。一端发起请求，一端做出响应，发请求端只能发请求，响应端只能作出响应，两者不能交换，这是不平等的

2. HTTP是一个无状态协议，本次请求和上次请求没有任何关系(举例：人与人对话有上下文关系，比如：网银登录，今天登陆后，明天用还要登录)

## 作用

1. 规定了客户端和服务器之间的数据传输格式
2. 让客户端和服务器能够进行有效的数据沟通

## 优势

1. 简单快速 
2. 灵活 http允许传输任意类型的数据
3. 1.1版本之前非持续性链接，限制每次连接只处理一个请求，服务器对客户端做出回应之后，马上断开链接。

## 工作原理

HTTP协议定义Web客户端如何从Web服务器请求Web页面，以及服务器如何把Web页面传送给客户端。HTTP协议采用了请求/响应模型。客户端向服务器发送一个请求报文，请求报文包含请求的方法、URL、协议版本、请求头部和请求数据。服务器以一个状态行作为响应，响应的内容包括协议的版本、成功或者错误代码、服务器信息、响应头部和响应数据。

以下是 HTTP 请求/响应的步骤：

1. 客户端连接到Web服务器
   一个HTTP客户端，通常是浏览器，与Web服务器的HTTP端口（默认为80）建立一个TCP套接字连接。例如，[http://www.baidu.com](http://www.baidu.com/)。

2. 发送HTTP请求
   通过TCP套接字，客户端向Web服务器发送一个文本的请求报文，一个请求报文由请求行、请求头部、空行和请求数据4部分组成。

3. 服务器接受请求并返回HTTP响应
   Web服务器解析请求，定位请求资源。服务器将资源复本写到TCP套接字，由客户端读取。一个响应由状态行、响应头部、空行和响应数据4部分组成。

4. 释放连接TCP连接
   若connection 模式为close，则服务器主动关闭TCP连接，客户端被动关闭连接，释放TCP连接;若connection 模式为keepalive，则该连接会保持一段时间，在该时间内可以继续接收请求;

5. 客户端浏览器解析HTML内容
   客户端浏览器首先解析状态行，查看表明请求是否成功的状态代码。然后解析每一个响应头，响应头告知以下为若干字节的HTML文档和文档的字符集。客户端浏览器读取响应数据HTML，根据HTML的语法对其进行格式化，并在浏览器窗口中显示。

例如：在浏览器地址栏键入URL，按下回车之后会经历以下流程：

1. 浏览器向 DNS 服务器请求解析该 URL 中的域名所对应的 IP 地址;
2. 解析出 IP 地址后，根据该 IP 地址和默认端口 80，和服务器建立TCP连接;
3. 浏览器发出读取文件(URL 中域名后面部分对应的文件)的HTTP 请求，该请求报文作为 TCP 三次握手的第三个报文的数据发送给服务器;
4. 服务器对浏览器请求作出响应，并把对应的 html 文本发送给浏览器;
5. 释放 TCP连接;
6. 浏览器将该 html 文本显示内容

## 基于 请求-响应 的模式

HTTP协议规定，请求从客户端发出，最后服务器端响应该请求并返回。换句话说，肯定是先从客户端开始建立通信的，服务器端在没有接收到请求之前不会发送响应。

![img](https://s2.loli.net/2022/02/15/YoFJNl7HtqnspI8.png)

## 无状态保存

HTTP是一种不保存状态，即无状态(stateless)协议。HTTP协议自身不对请求和响应之间的通信状态进行保存。也就是说在HTTP这个级别，协议对于发送过的请求或响应都不做持久化处理。

无状态是指Web浏览器与Web服务器之间不需要建立持久的连接，这意味着当一个客户端向服务器端发出请求，然后Web服务器返回响应（Response），连接就被关闭了，在服务器端不保留连接的有关信息。

　　　　![img](https://s2.loli.net/2022/02/15/TYMVdIeU6zAXfJK.png)



## 无连接

无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间，并且可以提高并发性能，不能和每个用户建立长久的连接，请求一次相应一次，服务端和客户端就中断了。

但是无连接有两种方式，早期的http协议是一个请求一个响应之后，直接就断开了，但是现在的http协议1.1版本不是直接就断开了，而是等几秒钟，这几秒钟是等什么呢，等着用户有后续的操作，如果用户在这几秒钟之内有新的请求，那么还是通过之前的连接通道来收发消息，如果过了这几秒钟用户没有发送新的请求，那么就会断开连接，这样可以提高效率，减少短时间内建立连接的次数，因为建立连接也是耗时的，默认的好像是3秒中现在，但是这个时间是可以通过咱们后端的代码来调整的，自己网站根据自己网站用户的行为来分析统计出一个最优的等待时间。

# HTTP发送请求的方法

## 请求方法

HTTP/1.1协议中共定义了八种方法来以不同方式操作指定的资源。

请求方法（所有方法全为大写）：

- **GET**：向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据，而不应当被用于产生“副作用”的操作。
- **POST**：向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。
- **HEAD**：与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。
- **PUT**：向指定资源位置上传其最新内容。
- **DELETE**：请求服务器删除Request-URI所标识的资源。
- **TRACE**：回显服务器收到的请求，主要用于测试或诊断。
- **CONNECT**：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。通常用于SSL加密服务器的链接（经由非加密的HTTP代理服务器）。
- **OPTIONS**：这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用'*'来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。

最常用的请求方法：GET 和 POST

## 参数

参数就是传递给服务器的具体数据，比如登陆时候传递的用户名、密码

```
username=jxz&password=123
```

客户端给服务端传递参数常用的有GET和POST，GET和POST传递参数方式不同：

## GET传参

GET提交的数据会放在URL之后，也就是请求行里面，以?分割URL和传输数据，多个参数之间以&相连。

比如：http://www.zhiyou100.com/login?username=jxz&password=123，其中?后面的username=jxz&password=123就是参数

这种在 URL 地址后面拼接的参数，叫做**查询字符串**。

由于浏览器和服务器对URL长度有限制，因此后面跟的参数长度就有限制，通常不超过1KB

## POST传参

 POST方法是把提交的数据放在HTTP包的请求体中

理论上讲，POST在传递的数据量上没有限制（看服务器的处理能力）

## GET和POST的选择

1. 如果要传递大量数据、文件，只能用POST请求	
2. GET比POST安全性差，如果包含敏感机密信息，建议POST
3. 如果仅仅只是索取数据，建议使用GET
4. 如果客户端跟服务器有很多数据操作，使用POST

# HTTP状态码

所有HTTP响应的第一行都是状态行，依次是当前HTTP版本号，3位数字组成的状态代码，以及描述状态的短语，彼此由空格分隔。

状态代码的第一个数字代表当前响应的类型，且有五种可能取值：

- 1xx：指示信息--表示请求已接收，继续处理
- 2xx：成功--表示请求已被成功接收、理解、接受
- 3xx：重定向--要完成请求必须进行更进一步的操作
- 4xx：客户端错误--请求有语法错误或请求无法实现
- 5xx：服务器端错误--服务器未能实现合法的请求

虽然 RFC 2616 中已经推荐了描述状态的短语，例如"200 OK"，"404 Not Found"，但是WEB开发者仍然能够自行决定采用何种短语，用以显示本地化的状态描述或者自定义信息。

![img](https://s2.loli.net/2022/02/15/zxPHpcvRJKhYX1b.png)

常见状态代码、状态描述、说明：

- 200 OK      //客户端请求成功
- 400 Bad Request  //客户端请求有语法错误，不能被服务器所理解
- 401 Unauthorized //请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用 
- 403 Forbidden  //服务器收到请求，但是拒绝提供服务
- 404 Not Found  //请求资源不存在，eg：输入了错误的URL
- 500 Internal Server Error //服务器内部发生不可预期的错误，无法完成请求
- 503 Server Unavailable  //服务器当前不能处理客户端的请求，一段时间后可能恢复正常	

例如：HTTP/1.1 200 OK 

完整的状态码：https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status

# HTTP通信过程

http通信过程包含请求报文和响应报文

## 请求报文

http请求报文 ：客户端向服务器发送数据

- 请求行：http协议版本、请求方法、请求资源路径
- 请求头：包含了对客户端的环境描述，客户端请求的主机地址等信息。
- 空行
- 请求体：客户端发给服务器的具体数据。

![image-20220220170551648](https://s2.loli.net/2022/02/20/lHMaS5gKfhTnqt1.png)

## 响应报文

http响应报文：服务器返回给客户端数据

- 响应行：http协议版本、状态码、状态码的英文名称
- 响应头：包含了对服务器的一些描述，对返回数据的描述。
- 空行
- 响应体：服务器返回给客户端的具体数据。

![](https://s2.loli.net/2022/02/20/YwtqQ8LphOrRA2T.png)
